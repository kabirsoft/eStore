@page "/products/{Id:guid}"
@using eStore.Shared.Dtos
@using eStore.Client.Services.ProductService
@inject IProductService ProductService
@inject IJSRuntime JS
@inject NavigationManager Nav

<h3>Product Details</h3>

@if (product is null && !notFound)
{
    <p>Loading...</p>
}
else if (notFound)
{
    <p>Product not found.</p>
}
else
{
    <h4>@product!.Name</h4>
    <p>@product.Description</p>
    <p><strong>Price:</strong> @(product.PriceOre / 100.0m) @product.Currency</p>
    <p><strong>Active:</strong> @product.IsActive</p>

    <p style="margin-top:15px">
        <a href="/checkout/@product!.Id">Pay by card</a>
    </p>

    <p style="margin-top:15px">
        <a href="/products/edit/@product!.Id">Edit</a>
        <button style="margin-left:10px" @onclick="Delete">Delete</button>
    </p>
}

@code {
    [Parameter] public Guid Id { get; set; }

    private ProductDto? product;
    private bool notFound;

    protected override async Task OnInitializedAsync()
    {
        product = await ProductService.GetProductByIdAsync(Id);
        notFound = product is null;
    }

    private async Task Delete()
    {
        if (product is null) return;

        var confirmed = await JS.InvokeAsync<bool>(
            "confirm",
            $"Are you sure you want to delete '{product.Name}'?");

        if (!confirmed)
            return;

        var ok = await ProductService.DeleteProductAsync(product.Id);
        if (ok)
            Nav.NavigateTo("/products");
    }
}
